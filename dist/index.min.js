!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ejsComponent={})}(this,function(t){"use strict";const e=t=>"string"==typeof t,n=t=>"function"==typeof t,r=t=>Array.isArray(t),s=t=>{if("object"!=typeof t||null===t)return!1;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},o=(t,...e)=>{for(const n of Object.keys(e)){const i=e[n];for(const e of Object.keys(i)){const n=i[e];s(n)?t[e]=o(t[e]||{},n):r(n)?t[e]=o(t[e]||[],n):t[e]=n}}return t},i=/[\w-]+/,a=/^(data|aria)/,c=/[A-Z]/g,h=t=>{if((t=String(t)).match(i))return t.match(a)&&(t=t.replace(c,"-$&").toLowerCase()),t},l={logErrors(t){},componentCreated(t,e){},isSafeString:()=>!1,escapeValue:t=>t,tagNodeToString:t=>JSON.stringify(t)};class p{parentNode=null;toParent(t){return t instanceof p&&(this.parentNode=t),null===t&&(this.parentNode=null),this}isSafeString(t){return l.isSafeString(t)}hasChildNodes(t){return t instanceof d}getNode(t){return t instanceof p?t:this.isSafeString(t)?new u(t):e(t)||"number"==typeof t?new f(t):s(t)&&e(t.tag)&&s(t.attrs)?new g(t.tag,t.attrs,t.content||[]):void 0}prependTo(t){this.hasChildNodes(t)&&t.prepend(this)}appendTo(t){return this.hasChildNodes(t)&&t.append(this),this}remove(){if(this.hasChildNodes(this.parentNode)){const t=this.parentNode.content,e=t.indexOf(this.toParent(null));~e&&t.splice(e,1)}}toString(){return""}toJSON(){return{}}}class u extends p{constructor(t){super(),this.html=String(t)}toString(){return this.html}toJSON(){return{html:this.html}}}class f extends p{constructor(t){super(),this.text=String(l.escapeValue(t))}toString(){return this.text}toJSON(){return{text:this.text}}}class d extends p{constructor(t){super(),this.content=[],r(t)?t.forEach(this.append.bind(this)):this.append(t)}toJSON(){return{content:this.content}}toString(){return String(this.content.join(""))}append(t){return(t=this.getNode(t))instanceof p&&this.content.push(t.toParent(this)),this}prepend(t){return(t=this.getNode(t))instanceof p&&this.content.unshift(t.toParent(this)),this}empty(){return this.content.forEach(t=>{t.toParent(null)}),this.content.splice(0,this.content.length),this}}class g extends d{constructor(t,e,n){super(n),this.tag=t,this.attrs={},this.attr(e)}toString(){return l.tagNodeToString(this.toJSON())}toJSON(){return{tag:this.tag,attrs:this.attrs,content:this.content}}getAttribute(t){if(t=h(t))return this.attrs[t]}removeAttribute(t){(t=h(t))&&delete this.attrs[t]}setAttribute(t,e){(t=h(t))&&(null==e?delete this.attrs[t]:this.attrs[t]=e)}classList(){return String(this.getAttribute("class")||"").trim().split(/\s+/)}addClass(...t){const e=this.classList();return t.forEach(t=>{t&&!~e.indexOf(t)&&e.push(t)}),this.setAttribute("class",e.join(" ").trim()),this}removeClass(...t){const e=this.classList();return t.forEach(t=>{if(t){const n=e.indexOf(t);~n&&e.splice(n,1)}}),this.setAttribute("class",e.join(" ").trim()),this}attr(t,e){s(t)?Object.entries(t).forEach(([t,e])=>{this.setAttribute(t,e)}):this.setAttribute(t,e)}}function m(t,r){let s,o;return s=e(t.tag)?new g(t.tag,t.attrs,t.content):new d(t.content),n(r)&&(o=r(s,t,m.prototype)),o||s}m.prototype={create:(t,e,n)=>new g(t,e,n),list:t=>new d(t),safe:t=>new u(t),call(t,e,n){const r=b.get(t);if(r)return r(e||{},n)},pick(t,e,n){return Object.assign(Object.fromEntries(Object.entries(this.clean(t)).filter(([t])=>!!~e.indexOf(t))),this.clean(n))},omit(t,e,n){return Object.assign(Object.fromEntries(Object.entries(this.clean(t)).filter(([t])=>!~e.indexOf(t))),this.clean(n))},clean:t=>t?Object.fromEntries(Object.entries(t).filter(([t,e])=>void 0!==e)):{},join:(t,e)=>[].slice.call(t).join(e).trim(),hasProp:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},m.extend=(t,e={})=>(Object.entries(t).forEach(([t,n])=>{m.defineProperty(t,n,e)}),m),m.defineProperty=(t,e,{writable:n,configurable:r,enumerable:s})=>Object.defineProperty(m.prototype,t,{value:e,writable:n,configurable:r,enumerable:s});const b=new Map;t.Component=m,t.ComponentListNode=d,t.ComponentNode=p,t.ComponentSafeNode=u,t.ComponentTagNode=g,t.ComponentTextNode=f,t.configureComponent=(t={})=>{n(t.logErrors)&&(l.logErrors=t.logErrors),n(t.escapeValue)&&(l.escapeValue=t.escapeValue),n(t.componentCreated)&&(l.componentCreated=t.componentCreated),n(t.tagNodeToString)&&(l.tagNodeToString=t.tagNodeToString),n(t.isSafeString)&&(l.isSafeString=t.isSafeString)},t.createComponent=(t,e)=>{const n=e.props||{},r=e.render,s=(t,e)=>{const s=o({},n,t||{});e&&(s.content=e);try{return m(s,r)}catch(t){l.logErrors(t)}};return b.set(t,s),l.componentCreated(t,s),s},t.getComponent=t=>b.get(t),t.removeComponent=t=>{b.delete(t)}});
