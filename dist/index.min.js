!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ejsComponent={})}(this,function(t){"use strict";const e=t=>"string"==typeof t,n=t=>"function"==typeof t,r=t=>{if("object"!=typeof t||null===t)return!1;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},s=(t,...e)=>{for(const n of Object.keys(e)){const o=e[n];for(const e of Object.keys(o)){const n=o[e];r(n)?t[e]=s(t[e]||{},n):Array.isArray(n)?t[e]=s(t[e]||[],n):t[e]=n}}return t},o=/[\w-]+/,i=/^(data|aria)/,a=/[A-Z]/g,c=t=>{if((t=String(t)).match(o))return t.match(i)&&(t=t.replace(a,"-$&").toLowerCase()),t},h={logErrors(t){},componentCreated(t,e){},isSafeString:()=>!1,escapeValue:t=>t,tagNodeToString:t=>JSON.stringify(t)};class p{parentNode=null;toParent(t){return t instanceof p&&(this.parentNode=t),null===t&&(this.parentNode=null),this}isSafeString(t){return h.isSafeString(t)}hasChildNodes(t){return t instanceof d}getNode(t){return t instanceof p?t:this.isSafeString(t)?new l(t):e(t)||"number"==typeof t?new u(t):r(t)&&e(t.tag)&&r(t.attrs)?new f(t.tag,t.attrs,t.content||[]):void 0}prependTo(t){this.hasChildNodes(t)&&t.prepend(this)}appendTo(t){return this.hasChildNodes(t)&&t.append(this),this}remove(){if(this.hasChildNodes(this.parentNode)){const t=this.parentNode.content,e=t.indexOf(this.toParent(null));~e&&t.splice(e,1)}}toString(){return""}toJSON(){return{}}}class l extends p{constructor(t){super(),this.html=String(t)}toString(){return this.html}toJSON(){return{html:this.html}}}class u extends p{constructor(t){super(),this.text=String(h.escapeValue(t))}toString(){return this.text}toJSON(){return{text:this.text}}}class d extends p{constructor(t){super(),this.content=[],Array.isArray(t)?t.forEach(this.append.bind(this)):this.append(t)}toJSON(){return{content:this.content}}toString(){return String(this.content.join(""))}append(t){return(t=this.getNode(t))instanceof p&&this.content.push(t.toParent(this)),this}prepend(t){return(t=this.getNode(t))instanceof p&&this.content.unshift(t.toParent(this)),this}empty(){return this.content.forEach(t=>{t.toParent(null)}),this.content.splice(0,this.content.length),this}}class f extends d{constructor(t,e,n){super(n),this.tag=t,this.attrs={},this.attr(e)}toString(){return h.tagNodeToString(this.toJSON())}toJSON(){return{tag:this.tag,attrs:this.attrs,content:this.content}}getAttribute(t){if(t=c(t))return this.attrs[t]}removeAttribute(t){(t=c(t))&&delete this.attrs[t]}setAttribute(t,e){(t=c(t))&&(null==e?delete this.attrs[t]:this.attrs[t]=e)}classList(){return String(this.getAttribute("class")||"").trim().split(/\s+/)}addClass(...t){const e=this.classList();return t.forEach(t=>{t&&!~e.indexOf(t)&&e.push(t)}),this.setAttribute("class",e.join(" ").trim()),this}removeClass(...t){const e=this.classList();return t.forEach(t=>{if(t){const n=e.indexOf(t);~n&&e.splice(n,1)}}),this.setAttribute("class",e.join(" ").trim()),this}attr(t,e){r(t)?Object.entries(t).forEach(([t,e])=>{this.setAttribute(t,e)}):this.setAttribute(t,e)}}function g(t,r){let s,o;return s=e(t.tag)?new f(t.tag,t.attrs,t.content):new d(t.content),n(r)&&(o=r(s,t,g.prototype)),o||s}g.prototype={empty:()=>new p,create:(t,e,n)=>new f(t,e,n),list:t=>new d(t),safe:t=>new l(t),call(t,e,n){const r=m.get(t);if(r)return r(e||{},n)},pick(t,e,n){return Object.assign(Object.fromEntries(Object.entries(this.clean(t)).filter(([t])=>!!~e.indexOf(t))),this.clean(n))},omit(t,e,n){return Object.assign(Object.fromEntries(Object.entries(this.clean(t)).filter(([t])=>!~e.indexOf(t))),this.clean(n))},clean:t=>t?Object.fromEntries(Object.entries(t).filter(([t,e])=>void 0!==e)):{},join:(t,e)=>[].slice.call(t).join(e).trim(),hasProp:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),getNodeItem(t){if(t instanceof p)return t;if(Array.isArray(t)){const[e,n,r]=t;return this.call(e,n,r)}return this.empty()},prependList(t,e){Array.isArray(t)&&t.reverse().forEach(t=>{(t=this.getNodeItem(t))&&t.prependTo(e)})},appendList(t,e){Array.isArray(t)&&t.forEach(t=>{(t=this.getNodeItem(t))&&t.appendTo(e)})}},g.extend=(t,e={})=>(Object.entries(t).forEach(([t,n])=>{g.defineProperty(t,n,e)}),g),g.defineProperty=(t,e,{writable:n,configurable:r,enumerable:s})=>Object.defineProperty(g.prototype,t,{value:e,writable:n,configurable:r,enumerable:s});const m=new Map;t.Component=g,t.ComponentListNode=d,t.ComponentNode=p,t.ComponentSafeNode=l,t.ComponentTagNode=f,t.ComponentTextNode=u,t.configureComponent=(t={})=>{n(t.logErrors)&&(h.logErrors=t.logErrors),n(t.escapeValue)&&(h.escapeValue=t.escapeValue),n(t.componentCreated)&&(h.componentCreated=t.componentCreated),n(t.tagNodeToString)&&(h.tagNodeToString=t.tagNodeToString),n(t.isSafeString)&&(h.isSafeString=t.isSafeString)},t.createComponent=(t,e)=>{const n=e.props||{},r=e.render,o=(t,e)=>{const o=s({},n,t||{});e&&(o.content=e);try{return g(o,r)}catch(t){h.logErrors(t)}};return m.set(t,o),h.componentCreated(t,o),o},t.getComponent=t=>m.get(t),t.removeComponent=t=>{m.delete(t)}});
