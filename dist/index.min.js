!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ejsComponent={})}(this,function(t){"use strict";const e=t=>"string"==typeof t,r=t=>"function"==typeof t,n=t=>{if("object"!=typeof t||null===t)return!1;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},s=(t,...e)=>{for(const r of Object.keys(e)){const o=e[r];for(const e of Object.keys(o)){const r=o[e];n(r)?t[e]=s(t[e]||{},r):Array.isArray(r)?t[e]=s(t[e]||[],r):t[e]=r}}return t},o=/[\w-]+/,i=/^(data|aria)/,a=/[A-Z]/g,c=t=>{if((t=String(t)).match(o))return t.match(i)&&(t=t.replace(a,"-$&").toLowerCase()),t},h={logErrors(){},componentCreated(t,e){},isSafeString:()=>!1,escapeValue:t=>t,tagNodeToString:t=>JSON.stringify(t)};class u{parentNode=null;toParent(t){return t instanceof u&&(this.parentNode=t),null===t&&(this.parentNode=null),this}isSafeString(t){return h.isSafeString(t)}hasChildNodes(t){return t instanceof d}getNode(t){return t instanceof u?t:this.isSafeString(t)?new p(t):e(t)||"number"==typeof t?new l(t):n(t)&&e(t.tag)&&n(t.attrs)?new f(t.tag,t.attrs,t.content||[]):void 0}prependTo(t){this.hasChildNodes(t)&&t.prepend(this)}appendTo(t){return this.hasChildNodes(t)&&t.append(this),this}remove(){if(this.hasChildNodes(this.parentNode)){const t=this.parentNode.content,e=t.indexOf(this.toParent(null));~e&&t.splice(e,1)}}toString(){return""}toJSON(){return{}}}class p extends u{constructor(t){super(),this.html=String(t)}toString(){return this.html}toJSON(){return{html:this.html}}}class l extends u{constructor(t){super(),this.text=String(h.escapeValue(t))}toString(){return this.text}toJSON(){return{text:this.text}}}class d extends u{constructor(t){super(),this.content=[],Array.isArray(t)?t.forEach(this.append.bind(this)):this.append(t)}toJSON(){return{content:this.content}}toString(){return String(this.content.join(""))}append(t){return(t=this.getNode(t))instanceof u&&this.content.push(t.toParent(this)),this}prepend(t){return(t=this.getNode(t))instanceof u&&this.content.unshift(t.toParent(this)),this}empty(){return this.content.forEach(t=>{t.toParent(null)}),this.content.splice(0,this.content.length),this}}class f extends d{constructor(t,e,r){super(r),this.tag=t,this.attrs={},this.attr(e)}toString(){return h.tagNodeToString(this.toJSON())}toJSON(){return{tag:this.tag,attrs:this.attrs,content:this.content}}getAttribute(t){if(t=c(t))return this.attrs[t]}removeAttribute(t){(t=c(t))&&delete this.attrs[t]}setAttribute(t,e){(t=c(t))&&(null==e?delete this.attrs[t]:this.attrs[t]=e)}toggleAttribute(t,e){(t=c(t))&&(!0===e?this.attrs[t]="":delete this.attrs[t])}hasAttribute(t){return this.attrs.hasOwnProperty(c(t))}classList(){return String(this.attrs.class||"").trim().split(/\s+/)}addClass(...t){const e=this.classList();return t.forEach(t=>{t&&!~e.indexOf(t)&&e.push(t)}),this.attrs.class=e.join(" ").trim(),this}removeClass(...t){const e=this.classList();return t.forEach(t=>{if(t){const r=e.indexOf(t);~r&&e.splice(r,1)}}),this.attrs.class=e.join(" ").trim(),this}attr(t,e){n(t)?Object.entries(t).forEach(([t,e])=>{this.setAttribute(t,e)}):this.setAttribute(t,e)}}class g{static extend(t,e={}){return Object.entries(t).forEach(([t,r])=>{g.defineProperty(t,r,e)}),g}static defineProperty(t,e,{writable:r,configurable:n,enumerable:s}={}){return Object.defineProperty(g.prototype,t,{value:e,writable:r,configurable:n,enumerable:s})}empty(){return new u}create(t,e,r){return new f(t,e,r)}list(t){return new d(t)}safe(t){return new p(t)}call(t,e,r){const n=y.get(t);if(n)return n(e||{},r)}pick(t,e,r){return Object.assign(Object.fromEntries(Object.entries(this.clean(t)).filter(([t])=>!!~e.indexOf(t))),this.clean(r))}omit(t,e,r){return Object.assign(Object.fromEntries(Object.entries(this.clean(t)).filter(([t])=>!~e.indexOf(t))),this.clean(r))}clean(t){return t?Object.fromEntries(Object.entries(t).filter(([t,e])=>void 0!==e)):{}}join(t,e){return Array.from(t).join(e).trim()}hasProp(t,e){return Object.prototype.hasOwnProperty.call(t,e)}getNodeItem(t){if(t instanceof u)return t;if(Array.isArray(t)){const[e,r,n]=t;return this.call(e,r,n)}return this.empty()}prependList(t,e){Array.isArray(t)&&t.reverse().forEach(t=>{(t=this.getNodeItem(t))&&t.prependTo(e)})}appendList(t,e){Array.isArray(t)&&t.forEach(t=>{(t=this.getNodeItem(t))&&t.appendTo(e)})}}const m=(t,n)=>{let s,o,i=new g;return s=e(t.tag)?new f(t.tag,t.attrs,t.content):new d(t.content),r(n)&&(o=n(s,t,i)),o||s},y=new Map,S=t=>y.get(t);t.Component=g,t.ComponentListNode=d,t.ComponentNode=u,t.ComponentSafeNode=p,t.ComponentTagNode=f,t.ComponentTextNode=l,t.TreeComponent=class{constructor(t){this.root=this.render(t,this)}render(t,r){if(Array.isArray(t)){const[s,o,i]=t;if(n(o)){if(e(s)){const t=S(s);if(void 0===t)return;const{$key:n,...a}=o,c=t(a,this.render(i,r));return e(n)&&(r[n]=c),c}return}return new d(t.map(t=>this.render(t,r)))}return new l(t)}toString(){return String(this.root)}},t.configureComponent=(t={})=>{r(t.logErrors)&&(h.logErrors=t.logErrors),r(t.escapeValue)&&(h.escapeValue=t.escapeValue),r(t.componentCreated)&&(h.componentCreated=t.componentCreated),r(t.tagNodeToString)&&(h.tagNodeToString=t.tagNodeToString),r(t.isSafeString)&&(h.isSafeString=t.isSafeString)},t.createComponent=(t,e)=>{const r=e.props||{},n=e.render,o=(t,e)=>{const o=s({},r,t||{});e&&(o.content=e);try{return m(o,n)}catch(t){h.logErrors(t)}};return y.set(t,o),h.componentCreated(t,o),o},t.getComponent=S,t.removeComponent=t=>{y.delete(t)},t.renderComponent=m});
