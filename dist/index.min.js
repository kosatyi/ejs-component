!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ejsComponent={})}(this,function(t){"use strict";const e=t=>"string"==typeof t,r=t=>"function"==typeof t,n=t=>{if(!t||"object"!=typeof t)return!1;const e=Object.getPrototypeOf(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e))&&"[object Object]"===Object.prototype.toString.call(t)},s=(t,...e)=>{for(const r of Object.keys(e))for(const o of Object.keys(e[r])){const i=e[r][o];n(i)?t[o]=s(t[o]||{},i):Array.isArray(i)?t[o]=s(t[o]||[],i):t[o]=i}return t},o=/[\w-]+/,i=/^(data|aria)/,a=/[A-Z]/g,c=t=>{if((t=String(t)).match(o))return t.match(i)&&(t=t.replace(a,"-$&").toLowerCase()),t},h={logErrors(){},componentCreated(t,e){},isSafeString:()=>!1,escapeValue:t=>t,tagNodeToString:t=>JSON.stringify(t)};class u{parentNode=null;toParent(t){return t instanceof u&&(this.parentNode=t),null===t&&(this.parentNode=null),this}isSafeString(t){return h.isSafeString(t)}hasChildNodes(t){return t instanceof d}getNode(t){return t instanceof u?t:this.isSafeString(t)?new p(t):e(t)||"number"==typeof t?new l(t):n(t)&&e(t.tag)&&n(t.attrs)?new f(t.tag,t.attrs,t.content||[]):void 0}prependTo(t){this.hasChildNodes(t)&&t.prepend(this)}appendTo(t){return this.hasChildNodes(t)&&t.append(this),this}remove(){if(this.hasChildNodes(this.parentNode)){const t=this.parentNode.content;t.splice(t.indexOf(this.toParent(null)),1)}return this}toString(){return""}toJSON(){return{}}}class p extends u{constructor(t){super(),this.html=String(t)}toString(){return this.html}toJSON(){return{html:this.html}}}class l extends u{constructor(t){super(),this.text=String(h.escapeValue(t))}toString(){return this.text}toJSON(){return{text:this.text}}}class d extends u{constructor(t){super(),this.content=[],t instanceof d?this.content=Array.from(t.content):Array.isArray(t)?t.forEach(this.append.bind(this)):this.append(t)}toJSON(){return{content:this.content}}toString(){return String(this.content.join(""))}append(t){return(t=this.getNode(t))instanceof u&&this.content.push(t.toParent(this)),this}prepend(t){return(t=this.getNode(t))instanceof u&&this.content.unshift(t.toParent(this)),this}empty(){return this.content.forEach(t=>{t.toParent(null)}),this.content.splice(0,this.content.length),this}}class f extends d{constructor(t,e,r){super(r),this.tag=t,this.attrs={},this.attr(e)}toString(){return h.tagNodeToString(this.toJSON())}toJSON(){return{tag:this.tag,attrs:this.attrs,content:this.content}}getAttribute(t){if(t=c(t))return this.attrs[c(t)]}removeAttribute(t){(t=c(t))&&delete this.attrs[c(t)]}setAttribute(t,e){(t=c(t))&&(null==e?delete this.attrs[t]:this.attrs[t]=e)}toggleAttribute(t,e){t=c(t),!0===e?this.attrs[t]="":delete this.attrs[t]}hasAttribute(t){return this.attrs.hasOwnProperty(c(t))}classList(){return String(this.attrs.class||"").trim().split(/\s+/)}addClass(...t){const e=this.classList();return t.forEach(t=>{t&&!~e.indexOf(t)&&e.push(t)}),this.attrs.class=e.join(" ").trim(),this}removeClass(...t){const e=this.classList();return t.forEach(t=>{if(!t)return;const r=e.indexOf(t);~r&&e.splice(r,1)}),this.attrs.class=e.join(" ").trim(),this}attr(t,e){n(t)?Object.entries(t).forEach(([t,e])=>{this.setAttribute(t,e)}):this.setAttribute(t,e)}}class g extends u{constructor(t){super(),this.root=this.#t(t)}#t(t){if(Array.isArray(t)){const[r,s,o]=t;if(e(r)&&n(s)){const t=b(r);if(void 0===t)return;const{$key:n,...i}=s,a=t(i,this.#t(o));return e(n)&&(this[n]=a),a}return new d(t.filter(t=>void 0!==t).map(t=>this.#t(t)))}return this.getNode(t)}toString(){return String(this.root)}toJSON(){return this.root}}class m{static extend(t,e={}){return Object.entries(t).forEach(([t,r])=>{m.defineProperty(t,r,e)}),m}static defineProperty(t,e,{writable:r,configurable:n,enumerable:s}={}){return Object.defineProperty(m.prototype,t,{value:e,writable:r,configurable:n,enumerable:s})}empty(){return new u}create(t,e,r){return new f(t,e,r)}tree(t){return new g(t)}list(t){return new d(t)}safe(t){return new p(t)}call(t,e,r){const n=y.get(t);if(n)return n(e||{},r)}pick(t,e,r){return Object.assign(Object.fromEntries(Object.entries(this.clean(t)).filter(([t])=>!!~e.indexOf(t))),this.clean(r))}omit(t,e,r){return Object.assign(Object.fromEntries(Object.entries(this.clean(t)).filter(([t])=>!~e.indexOf(t))),this.clean(r))}clean(t){return t?Object.fromEntries(Object.entries(t).filter(([t,e])=>void 0!==e)):{}}join(t,e){if(t)return Array.from(t).join(e).trim()}hasProp(t,e){return Object.prototype.hasOwnProperty.call(t,e)}getNodeItem(t){if(t instanceof u)return t;if(Array.isArray(t)&&t.length>1&&t.length<4){const[e,r,n]=t;return this.call(e,r,n)}}prependList(t,e){Array.isArray(t)&&t.reverse().forEach(t=>{const r=this.getNodeItem(t);r&&r.prependTo(e)})}appendList(t,e){Array.isArray(t)&&t.forEach(t=>{const r=this.getNodeItem(t);r&&r.appendTo(e)})}}const S=(t,n)=>{let s,o,i=new m;return s=e(t.tag)?new f(t.tag,t.attrs,t.content):new d(t.content),r(n)&&(o=n(s,t,i)),o||s},y=new Map,b=t=>y.get(t);t.Component=m,t.ComponentListNode=d,t.ComponentNode=u,t.ComponentSafeNode=p,t.ComponentTagNode=f,t.ComponentTextNode=l,t.ComponentTreeNode=g,t.configureComponent=(t={})=>{r(t.logErrors)&&(h.logErrors=t.logErrors),r(t.escapeValue)&&(h.escapeValue=t.escapeValue),r(t.componentCreated)&&(h.componentCreated=t.componentCreated),r(t.tagNodeToString)&&(h.tagNodeToString=t.tagNodeToString),r(t.isSafeString)&&(h.isSafeString=t.isSafeString)},t.createComponent=(t,e)=>{const r=e.props||{},n=e.render,o=(t,e)=>{const o=s({},r,t||{});e&&(o.content=e);try{return S(o,n)}catch(t){h.logErrors(t)}};return y.set(t,o),h.componentCreated(t,o),o},t.getComponent=b,t.removeComponent=t=>{y.delete(t)},t.renderComponent=S});
